# syntax=docker/dockerfile:1.0.0-experimental
FROM python:3

RUN printf "deb http://downloads.skewed.de/apt/buster buster main\ndeb-src http://downloads.skewed.de/apt/buster buster main\n" >> /etc/apt/sources.list
RUN apt-key adv --keyserver keys.openpgp.org --recv-key 612DEFB798507F25
RUN apt-get update
RUN apt-get install --yes --no-install-recommends --allow-unauthenticated python3-graph-tool
# LOL, anything to get graph_tool to import in python
RUN ln -s /usr/lib/python3/dist-packages/graph_tool /usr/local/lib/python3.8/site-packages/graph_tool

#ADD ./hashdos_vulnerability_detection/individual_files_analysis_driver.py /
#ADD ./hashdos_vulnerability_detection/input_dependence_analyses.py /
#ADD ./hashdos_vulnerability_detection/common_input_functions.py /
#ADD ./hashdos_vulnerability_detection/hash_func_use_context_analyses.py /
#ADD ./hashdos_vulnerability_detection/hash_func_search.py /
ADD ./hashdos_vulnerability_detection/ /hashdos_vulnerability_detection
ADD ./stashed_extended/ /stashed_extended

#RUN --mount=type=ssh,id=github_ssh_key git clone git@github.com:usc-isi-bass/hashdos_vulnerability_detection.git stashed_extended

RUN pip install pybase64
RUN pip install ipdb
RUN pip install pycairo
RUN pip install matplotlib
RUN pip install scipy
RUN pip install numpy
RUN pip install angr
RUN pip install archinfo
RUN pip install pyvex
RUN pip install claripy
RUN pip install cle
RUN pip install numpy
RUN pip install nose
RUN pip install /stashed_extended
#RUN pip install git+ssh://git@github.com:usc-isi-bass/hashdos_vulnerability_detection.git
#RUN --mount=type=ssh,id=github pip install git+ssh://git@github.com/usc-isi-bass/hashdos_vulnerability_detection.git

#CMD ["python3", "hashdos_vulnerability_detection/individual_files_analysis_driver.py"]
