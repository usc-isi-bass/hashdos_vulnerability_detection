#include <stdio.h>
#include <stdlib.h>
#include <string.h>

/* All these hash functions were copied from: https://www.partow.net/programming/hashfunctions/#RSHashFunction */
unsigned int __attribute__ ((noinline)) ELFHash(const char* str, unsigned int length)
{
   unsigned int hash = 0;
   unsigned int x    = 0;
   unsigned int i    = 0;
   char c;

   for (i = 0; i < length; ++str, ++i)
   {
      c = *str;
      if ('a' <= c && c <= 'z') {
        c -= 32;
      }
      hash = (hash << 4) + c;

      if ((x = hash & 0xF0000000L) != 0)
      {
         hash ^= (x >> 24);
      }

      hash &= ~x;
   }

   return hash;
}

int main(int argc, char *argv[])
{
	const char *key;
	unsigned int len;
	unsigned int h;
	if (argc < 2) {
		fprintf(stderr, "usage: %s <key>\n", argv[0]);
		return EXIT_SUCCESS;
	}
	key = argv[1];
	len = strlen(key);

    h = ELFHash(key, len);
	printf("h(%s) = %u\n", key, h);

	return EXIT_SUCCESS;
}
