#include <stdio.h>
#include <stdlib.h>
#include <ctype.h>

/* Now we have a real hash, but we use only the last byte of it :p */
static unsigned char __attribute__ ((noinline)) hash_func(const char *pkey)
{
    char c;
    unsigned long hash = 5381; /* 5381 & 0xff makes more sense */

    while ((c = *pkey++))
        hash = ((hash << 5) + hash) ^ toupper(c);
    return (unsigned char)hash;
}

void __attribute__ ((noinline)) dummy1(void)
{
}

void __attribute__ ((noinline)) dummy2(void)
{
}

void __attribute__ ((noinline)) dummy3(void)
{
}

void __attribute__ ((noinline)) dummy4(void)
{
}

void __attribute__ ((noinline)) dummy5(void)
{
}

void __attribute__ ((noinline)) dummy6(void)
{
}

void __attribute__ ((noinline)) dummy7(void)
{
}

int main(int argc, char *argv[])
{
    char *key;
    char h;
    if (argc < 2) {
        printf("%s <key>\n", argv[0]);
        return EXIT_SUCCESS;
    }
	dummy1();
	dummy2();
	dummy3();
	dummy4();
	dummy5();
	dummy6();
	dummy7();
    
    key = argv[1];
    h = hash_func(key);
    printf("h(%s) = %d\n", key, h);
    return EXIT_SUCCESS;
}
