import argparse
import json

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('results', help='the results file to query')
    args = parser.parse_args()
    results_file = args.results
    with open(results_file, 'r') as fd:
        elf_to_path_set = {}
        for i, line in enumerate(fd):
            line = line.strip()
            result = json.loads(line)
            deb_name = result[0]['deb']['deb_name']
            elf_name = result[0]['elf']['elf_name']
            elf_md5 = result[0]['elf']['elf_md5']
            #if 'hash_funcs' in results['analysis_metrics']:
            #if 'analysis_metrics' not in results[1]:
            #    print(results)

            print(deb_name, elf_name)
            hash_funcs = result[1]['hash_funcs']
            func_name_props_map = {}
            #print(hash_funcs)
            for hash_algo, hash_func, score, hash_props in hash_funcs:
                func_name_props_map[hash_func] = (hash_algo, score, hash_props)
            for hash_func_code in result[1]['hash_func_code']:
                hash_func_name = hash_func_code['hash_func']
                code = hash_func_code['hash_func_code']
                print(func_name_props_map[hash_func_name])
                print(hash_func_name)
                print(code)
 

if __name__ == "__main__":
        main()
